rule Generic_Malware_Indicators {
    meta:
        description = "Detects generic malware characteristics"
        author = "Security Tool"
        severity = "high"
        date = "2024-03-17"

    strings:
        $sus_cmd1 = "cmd.exe /c" nocase
        $sus_cmd2 = "powershell.exe -enc" nocase
        $sus_cmd3 = "rundll32.exe" nocase
        $sus_cmd4 = "regsvr32.exe" nocase
        
        $api1 = "CreateRemoteThread"
        $api2 = "VirtualAllocEx"
        $api3 = "WriteProcessMemory"
        
        $network1 = "ws2_32.dll"
        $network2 = "wininet.dll"
        
        $persistence1 = "CurrentVersion\\Run"
        $persistence2 = "CurrentVersion\\RunOnce"

    condition:
        uint16(0) == 0x5A4D and
        (
            (2 of ($sus_cmd*)) or
            (2 of ($api*)) or
            (all of ($network*)) or
            (any of ($persistence*))
        )
} 